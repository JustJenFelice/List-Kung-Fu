var ListKungFu={LayoutWest:$("#mainlayout-west"),LayoutNorth:$("#mainlayout-north"),LayoutEast:$("#mainlayout-east"),LayoutSouth:$("#mainlayout-south"),LayoutCenter:$("#mainlayout-center")};jQuery.expr[":"].Contains=function(i,a,c){return jQuery(i).text().toLowerCase().indexOf(c[3].toLowerCase())>=0};
$(document).ready(function(){ListKungFu.MainLayout=$("body").layout({defaults:{contentSelector:".ui-layout-content",contentIgnoreSelector:".ui-layout-ignore"},north:{maxSize:92,minSize:92},south:{minSize:50},west:{minSize:300},east:{minSize:100,initClosed:true},center:{minSize:300}});ListKungFu.LayoutSouth.StatusBar();ListKungFu.LayoutCenter.ListItemView({SelectLastList:function(){ListKungFu.LayoutWest.ListView("SelectList")},ContentDimensionsChanged:function(){ListKungFu.MainLayout.resizeContent("center")},
ReinitPanes:function(){ListKungFu.MainLayout.reinitPane()}});ListKungFu.LayoutWest.ListView({ContentDimensionsChanged:function(){ListKungFu.MainLayout.resizeContent("west")},OpenList:function(i,a){ListKungFu.LayoutCenter.Dashboard("Hide");ListKungFu.LayoutCenter.ListItemView("OpenList",a.selectedList)},CloseList:function(){ListKungFu.LayoutCenter.ListItemView("RemoveList")},SelectListItem:function(){ListKungFu.LayoutCenter.ListItemView("SelectListItem")}});ListKungFu.LayoutCenter.Dashboard({ContentDimensionsChanged:function(){ListKungFu.MainLayout.resizeContent("center")},
ReinitPanes:function(){ListKungFu.MainLayout.reinitPane()},OpenList:function(i,a){ListKungFu.LayoutCenter.Dashboard("Hide");ListKungFu.LayoutCenter.ListItemView("OpenList",a.selectedList)}});$("#dashboard").bind("click",function(){ListKungFu.LayoutCenter.ListItemView("RemoveList");ListKungFu.LayoutCenter.Dashboard("Show");return false});$("#dashboard").trigger("click")});
var Controller=function(i,a){var c={};a=a||{};a=function(){return document.location.protocol+"//"+document.location.hostname+(document.location.port!==""?":"+document.location.port:"")+"/"};var l=function(b){var e=$(b).length>0?{}:false;$(b).each(function(j,k){j=$(k).attr("model");var h=$(k).attr("field");k=$(k).text();e[j]=e[j]||{};e[j][h]=e[j][h]||[];e[j][h].push(k)});return e};c.ClearFlash=function(){c.flash={notice:"",error:"",warning:"",message:""}};c.ClearFlash();c.SetFlash=function(b){c.flash.notice=
b.getResponseHeader("X-Flash-Notice")||"";c.flash.error=b.getResponseHeader("X-Flash-Error")||"";c.flash.warning=b.getResponseHeader("X-Flash-Warning")||"";c.flash.message=b.getResponseHeader("X-Flash-Message")||"";if(typeof i.onFlashUpdate==="function")if(c.flash.notice!==""||c.flash.error!==""||c.flash.warning!==""||c.flash.message!=="")i.onFlashUpdate(c.flash.notice,c.flash.error,c.flash.warning,c.flash.message)};c.baseURL=i.base_url||a();c.route=i.route;c.DefaultCallback=function(b,e,j,k){c.SetFlash(k);
var h=$.parseJSON($(e).find("JSON").text()),g=$(e).find("Template").text();e=l($(e).find("Error"));typeof b==="function"&&b(g,h,j,k,e);c.ClearFlash()};c.DefaultErrorCallback=function(){$('<div id="dialog-confirm"> \t\t\t<span class="ui-icon ui-icon-alert" style="float:left; margin:0 7px 20px 0;"> \t\t\t</span>Something went wrong :-( Either try again or reload the page!</div>').dialog({resizable:false,modal:true,buttons:{"Try again":function(){$(this).dialog("close")},Reload:function(){window.location.reload()}}})};
c.ConstructRoute=function(b){for(var e="",j="",k=0;k<c.route.length;k++){e+=c.route[k];j=b[c.route[k]]||"";if(j!=="")e+="/"+j;if(k!==c.route.length-1)e+="/"}return e};c.Index=function(b){var e=b.successCallback||null,j=c.ConstructRoute(b);$.ajax({url:c.baseURL+j,dataType:"xml",type:"GET",processData:true,contentType:"application/json",data:b.send,success:function(k,h,g){c.DefaultCallback(e,k,h,g)},error:function(k,h,g){c.DefaultErrorCallback(k,h,g)}})};c.Show=function(b){var e=b.successCallback||
null;b=c.ConstructRoute(b);$.ajax({url:c.baseURL+b,dataType:"xml",type:"GET",processData:false,contentType:"application/json",success:function(j,k,h){c.DefaultCallback(e,j,k,h)},error:function(j,k,h){c.DefaultErrorCallback(j,k,h)}})};c.New=function(b){var e=b.successCallback||null;b=c.ConstructRoute(b);$.ajax({url:c.baseURL+b+"/new",dataType:"xml",type:"GET",processData:false,contentType:"application/json",success:function(j,k,h){c.DefaultCallback(e,j,k,h)},error:function(j,k,h){c.DefaultErrorCallback(j,
k,h)}})};c.Create=function(b){var e=b.successCallback||null,j=c.ConstructRoute(b);b=JSON.stringify(b.send);$.ajax({url:c.baseURL+j,dataType:"xml",type:"POST",processData:false,contentType:"application/json",data:b,success:function(k,h,g){c.DefaultCallback(e,k,h,g)},error:function(k,h,g){c.DefaultErrorCallback(k,h,g)}})};c.Edit=function(b){var e=b.successCallback||null;b=c.ConstructRoute(b);$.ajax({url:c.baseURL+b+"/edit",dataType:"xml",type:"GET",parseData:false,contentType:"application/json",success:function(j,
k,h){c.DefaultCallback(e,j,k,h)},error:function(j,k,h){c.DefaultErrorCallback(j,k,h)}})};c.Update=function(b){var e=b.successCallback||null,j=c.ConstructRoute(b);b=JSON.stringify(b.send);b=b.replace(/\\u000a/g,"\\n");$.ajax({url:c.baseURL+j,dataType:"xml",type:"POST",processData:false,contentType:"application/json",data:b,beforeSend:function(k){k.setRequestHeader("X-Http-Method-Override","PUT")},success:function(k,h,g){c.DefaultCallback(e,k,h,g)},error:function(k,h,g){c.DefaultErrorCallback(k,h,g)}})};
c.Destroy=function(b){var e=b.successCallback||null;b=c.ConstructRoute(b);$.ajax({url:c.baseURL+b,dataType:"xml",type:"POST",processData:false,contentType:"application/json",beforeSend:function(j){j.setRequestHeader("X-Http-Method-Override","DELETE")},success:function(j,k,h){c.DefaultCallback(e,j,k,h)},error:function(j,k,h){c.DefaultErrorCallback(j,k,h)}})};return c},List=Controller({route:["lists"],onFlashUpdate:function(i,a){ListKungFu.LayoutSouth.StatusBar("SetAlert",a);ListKungFu.LayoutSouth.StatusBar("SetNotice",
i)}}),ListListItem=Controller({route:["lists","list_items"],onFlashUpdate:function(i,a){ListKungFu.LayoutSouth.StatusBar("SetAlert",a);ListKungFu.LayoutSouth.StatusBar("SetNotice",i)}}),ListItem=Controller({route:["list_items"],onFlashUpdate:function(i,a){ListKungFu.LayoutSouth.StatusBar("SetAlert",a);ListKungFu.LayoutSouth.StatusBar("SetNotice",i)}});
jQuery(function(i){var a=i("meta[name=csrf-token]").attr("content"),c=i("meta[name=csrf-param]").attr("content");i.fn.extend({triggerAndReturn:function(b,e){b=new i.Event(b);this.trigger(b,e);return b.result!==false},callRemote:function(){var b=this,e=b.attr("method")||b.attr("data-method")||"GET",j=b.attr("action")||b.attr("href"),k=b.attr("data-type")||"script";if(j===undefined)throw"No URL specified for remote call (action or href must be present).";else{if(b.triggerAndReturn("ajax:before")){var h=
b.is("form")?b.serializeArray():[];i.ajax({url:j,data:h,dataType:k,type:e.toUpperCase(),beforeSend:function(g){b.trigger("ajax:loading",g)},success:function(g,r,t){b.trigger("ajax:success",[g,r,t])},complete:function(g){b.trigger("ajax:complete",g)},error:function(g,r,t){b.trigger("ajax:failure",[g,r,t])}})}b.trigger("ajax:after")}}});i("body").delegate("a[data-confirm], button[data-confirm], input[data-confirm]","click.rails",function(){var b=i(this);if(b.triggerAndReturn("confirm"))if(!confirm(b.attr("data-confirm")))return false});
i("form[data-remote]").live("submit.rails",function(b){i(this).callRemote();b.preventDefault()});i("a[data-remote],input[data-remote]").live("click.rails",function(b){i(this).callRemote();b.preventDefault()});i("a[data-method]:not([data-remote])").live("click.rails",function(b){var e=i(this),j=e.attr("href");e=e.attr("data-method");j=i('<form method="post" action="'+j+'"></form>');e='<input name="_method" value="'+e+'" type="hidden" />';if(c!==undefined&&a!==undefined)e+='<input name="'+c+'" value="'+
a+'" type="hidden" />';j.hide().append(e).appendTo("body");b.preventDefault();j.submit()});var l=function(){i(this).find("input[data-disable-with]").each(function(){var b=i(this);b.data("enable-with",b.val()).attr("value",b.attr("data-disable-with")).attr("disabled","disabled")})};i("form[data-remote]:has(input[data-disable-with])").live("ajax:before.rails",l);i("form:not([data-remote]):has(input[data-disable-with])").live("submit.rails",l);i("form[data-remote]:has(input[data-disable-with])").live("ajax:complete.rails",
function(){i(this).find("input[data-disable-with]").each(function(){var b=i(this);b.removeAttr("disabled").val(b.data("enable-with"))})});l=i().jquery;if(l==="1.4"||l==="1.4.1"||l==="1.4.2")alert("This rails.js does not support the jQuery version you are using. Please read documentation.")});
(function(i){i.confirmationDialog=function(a,c,l,b){dialog=i('<div id="dialog-confirm"> \t\t\t<span class="ui-icon ui-icon-alert" style="float:left; margin:0 7px 20px 0;"> \t\t\t</span>'+b+"</div>").dialog({resizable:false,modal:true,autoOpen:false,width:400,open:function(){dialog.parent().find(".ui-dialog-buttonpane > button").first().focus()}});b={};b[a]=function(){i(dialog).dialog("close");c()};b[l]=function(){i(dialog).dialog("close")};dialog.dialog("option","buttons",b);dialog.parent().find(".ui-dialog-buttonpane > button").bind("keydown",
"right",function(e){e=i(e.target);if(e.next("button").length>0){e.blur();e.next("button").focus()}return false});dialog.parent().find(".ui-dialog-buttonpane > button").bind("keydown","left",function(e){e=i(e.target);if(e.prev("button").length>0){e.blur();e.prev("button").focus()}return false});return dialog}})(jQuery);
(function(){var i=function(){var a=null,c=function(){a._trigger("ContentDimensionsChanged",0,{})},l=function(){a._trigger("ReinitPanes",0,{})};return{options:{},Show:function(){a.Hide();a.header=$('<div id="dashboard-header" class="header"><h1>Dashboard</h1></div>');a.toolbar=$('<div id="dashboard-toolbar"><input type="text" id="dashboard-search" value=""/></div>');a.wrapper=$('<div class="ui-layout-content" id="dashboard-view"></div>');a.today=$('<div id="today" class="schedule-column" data-type="scheduleColumn"><h1>Today</h1></div>');
a.tomorrow=$('<div id="tomorrow" class="schedule-column" data-type="scheduleColumn"><h1>Tomorrow</h1></div>');a.thisweek=$('<div id="thisweek" class="schedule-column" data-type="scheduleColumn"><h1>This Week</h1></div>');a.nextweek=$('<div id="nextweek" class="schedule-column" data-type="scheduleColumn"><h1>Next Week</h1></div>');a.later=$('<div id="later" data-type="scheduleColumn"><h1>Later</h1></div>');a.element.append(a.header);a.header.append(a.toolbar);a.element.append(a.wrapper);a.wrapper.append(a.today);
a.wrapper.append(a.tomorrow);a.wrapper.append(a.thisweek);a.wrapper.append(a.nextweek);a.nextweek.append(a.later);a.wrapper.append('<div style="clear:both;">&nbsp;</div>');a.toolbar.append('<div id="dashboard-search-cancel">&nbsp;</div>');ListItem.Index({successCallback:function(b,e){$.each(e,function(j,k){var h=$($.mustache(b,k.list_item));switch(k.list_item.deadline_category){case "today":a.today.append(h);break;case "tomorrow":a.tomorrow.append(h);break;case "this week":a.thisweek.append(h);break;
case "next week":a.nextweek.append(h);break;default:a.later.append(h);break}h.find(".dashboard-list-item-title").bind("click",function(){a._trigger("OpenList",0,{selectedList:k.list_item})});h.find(".dashboard-item-completed").bind("click",function(){$that=$(this);$that.find(".confirmation-completed").remove();var g=$('<div class="confirmation-completed">Completed? \t\t\t\t\t\t\t\t\t<span class="yes">Yes</span> / <span class="no">NO</span></div>');$that.append(g);$that.animate({width:"100%",paddingLeft:"14px"},
200);g.find(".yes").bind("click",function(){k.list_item.completed=true;ListListItem.Update({successCallback:function(){h.stop(true,true).hide("slow",function(){h.remove()})},lists:k.list_item.list_id,list_items:k.list_item.id,send:k});g.find(".no").trigger("click");return false});g.find(".no").bind("click",function(){$that.animate({width:"12px",paddingLeft:"0"},200,function(){g.remove()});return false})});h.find(".dashboard-item-more").bind("click",function(){a._trigger("OpenList",0,{selectedList:k.list_item})})});
$('div[data-type~="scheduleColumn"]').each(function(){$(this).children(".dashboard-item").length===0&&$(this).children("h1").after('<p class="nothing-todo">no items scheduled</p>')});l();c()},send:{show:"dashboard"}});a.toolbar.find("#dashboard-search").bind("keyup",function(){var b=$(this).val();if(b==="")a.wrapper.find(".dashboard-item").show();else{a.wrapper.find(".dashboard-item:not(:Contains('"+b+"'))").hide();a.wrapper.find(".dashboard-item:Contains('"+b+"')").show()}});a.toolbar.find("#dashboard-search-cancel").bind("click",
function(){a.toolbar.find("#dashboard-search").val("").trigger("keyup")});c()},Hide:function(){a.element.children().remove()},_create:function(){a=this},destroy:function(){}}}();$.widget("ui.Dashboard",i)})();
(function(i){function a(c){if(typeof c.data==="string"){var l=c.handler,b=c.data.toLowerCase().split(" ");c.handler=function(e){if(!(this!==e.target&&(/textarea|select/i.test(e.target.nodeName)||e.target.type==="text"))){var j=e.type!=="keypress"&&i.hotkeys.specialKeys[e.which],k=String.fromCharCode(e.which).toLowerCase(),h="",g={};if(e.altKey&&j!=="alt")h+="alt+";if(e.ctrlKey&&j!=="ctrl")h+="ctrl+";if(e.metaKey&&!e.ctrlKey&&j!=="meta")h+="meta+";if(e.shiftKey&&j!=="shift")h+="shift+";if(j)g[h+j]=
true;else{g[h+k]=true;g[h+i.hotkeys.shiftNums[k]]=true;if(h==="shift+")g[i.hotkeys.shiftNums[k]]=true}j=0;for(k=b.length;j<k;j++)if(g[b[j]])return l.apply(this,arguments)}}}}i.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",
106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",191:"/",224:"meta"},shiftNums:{"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"}};i.each(["keydown","keyup","keypress"],function(){i.event.special[this]={add:a}})})(jQuery);
(function(){var i=function(){var a=null,c=function(){a._trigger("ContentDimensionsChanged",0,{})},l=function(){a._trigger("ReinitPanes",0,{})},b=function(d,n){a.selectedListItem={element:d,data:n}},e=function(d){var n=d.find("#deadline-settings-wrapper"),p=d.find("#save-deadline");p.bind("click keydown","return",function(){p.data("settings-visible")?n.hide("fast",function(){n.find(".deadline-button").first();p.data("settings-visible",false)}):n.show("fast",function(){n.find(".deadline-button").first().focus();
p.data("settings-visible",true)});return false})},j=function(){$("#custom-deadline-display").datepicker({minDate:new Date,altField:"#custom-deadline-value",altFormat:"yy,mm,dd",dateFormat:"dd.mm.yy"});$("#custom-deadline-value").val($.datepicker.formatDate("yy,mm,dd",new Date));$("#custom-deadline-display").val($.datepicker.formatDate("dd.mm.yy",new Date))},k=function(d,n,p){var m=$($.mustache(n,d.list_item));m.data("data",d);m.data("isFullsize",false);p?a.listItemList.prepend(m):a.listItemList.append(m);
m.find(".handle").height(m.height());m.bind("keydown","space",function(){a.toolbar.find("#list-item-completed").effect("puff",{},300,function(){$(this).show();m.find(".undo").length===0?a.toolbar.find("#list-item-completed").trigger("click"):m.find(".undo").trigger("click")})});m.bind("keydown","del",function(){a.toolbar.find("#list-item-delete").effect("puff",{},300,function(){a.toolbar.find("#list-item-delete").trigger("click")})});m.bind("focus",function(s){if($(s.target).hasClass("row")){a.listItemList.find(".row").removeClass("selected-row");
$(s.target).addClass("selected-row");$(s.target).data("data");if(a.toolbar)$(s.target).data("isFullsize")===true?a.toolbar.find("#list-item-fullsize").button("option","icons",{primary:"ui-icon-zoomout"}):a.toolbar.find("#list-item-fullsize").button("option","icons",{primary:"ui-icon-zoomin"});b($(s.target),$(s.target).data("data"))}});m.bind("keydown","down",function(s){s.preventDefault();$(s.target).nextAll("div:visible").first().focus();return false});m.bind("keydown","up",function(s){s.preventDefault();
$(s.target).prevAll("div:visible").first().focus();return false});m.bind("keydown dblclick","return",function(){if(m.find("form").length>0)return false;a.toolbar.find("#list-item-edit").effect("puff",{},300,function(){$(this).show()});a.listItemList.find(".row").find("form").hide("slow",function(){$(this).remove()});ListListItem.Edit({successCallback:function(s){var v=$(s),w=m.data("isFullsize");v.hide();a.selectedListItem.element.prepend(v);v.find("textarea").markItUp(mySettings);e(v);j();w===false&&
h(m);a.selectedListItem.element.find(".handle").hide();v.show("slow",function(){v.find("textarea").focus()});v.find("textarea").bind("keydown","esc",function(){v.find("#cancel-edit").trigger("click")});v.find(".deadline-button").bind("keydown click","return",function(x){x.preventDefault();var z=m.find("form").serializeForm();z.list_item.deadlineType=$(x.target).attr("data-deadline");z.list_item.customDeadlineValue=$("#custom-deadline-value").val();ListListItem.Update({send:z,successCallback:function(A,
y){v.hide("slow",function(){$(this).remove();a.selectedListItem.element.find(".handle").show();m.find(".list-item-content").html(y.list_item.body_rendered);m.find(".list-item-deadline").html(y.list_item.deadline_in_words);m.find(".handle").height(m.find(".list-item-content").height());w===false&&h(m);b(m,y);m.data("data",y);m.focus()})},lists:a.selectedListItem.data.list_item.list_id,list_items:a.selectedListItem.data.list_item.id});return false});v.find("#cancel-edit").bind("keydown click","return",
function(x){x.preventDefault();a.selectedListItem.element.find(".handle").show();v.hide("slow",function(){$(this).remove();w===false&&h(m);m.focus()});return false});return false},lists:a.selectedListItem.data.list_item.list_id,list_items:a.selectedListItem.data.list_item.id})});m.bind("keydown","left",function(){a._trigger("SelectLastList",0,{})});m.bind("keydown","shift+return",function(){a.toolbar.find("#list-item-new").effect("puff",{},300,function(){$(this).show();o()})});m.bind("keydown","l",
function(){a.toolbar.find("#list-item-fullsize").effect("puff",{},300,function(){a.toolbar.find("#list-item-fullsize").trigger("click");$(this).show()});return false});ListKungFu&&ListKungFu.LayoutCenter&&m.draggable({helper:function(){return $('<div class="list-item-drag-helper">'+m.find(".list-item-content").text().substring(0,20)+" . . .</div>").get(0)},appendTo:ListKungFu.LayoutCenter,revert:"invalid",handle:".handle",cursorAt:{top:10,left:10},iframeFix:true,start:function(){document.onselectstart=
function(){return false}},stop:function(){document.onselectstart=null}});g(m)},h=function(d){if(d.data("isFullsize")===true){g(d,false);d.data("isFullsize",false);a.toolbar.find("#list-item-fullsize").button("option","icons",{primary:"ui-icon-zoomin"})}else{g(d,true);d.data("isFullsize",true);a.toolbar.find("#list-item-fullsize").button("option","icons",{primary:"ui-icon-zoomout"})}},g=function(d,n){d.height()>150&&!n?d.height(150):d.height("auto");c()},r=function(d,n){ListListItem.Destroy({successCallback:function(){d.hide("slow",
function(){var p=d.next(".row");p.length>0||(p=d.prev(".row"));p.focus();d.remove();a.toolbar.find("#list-item-search").trigger("ClearValue")})},lists:n.list_item.list_id,list_items:n.list_item.id})},t=function(d,n){n.list_item.completed=true;ListListItem.Update({successCallback:function(){var p="list-item-undo-"+n.list_item.id;d.find(".list-item-wrapper").hide("slow",function(){var m=$('<div class="undo clickable"><img src="/images/undo-icon.gif"/>Undo</div>');m.bind("click",function(){u(d,n,p)});
d.append(m);g(d);m.delay(5E3,p).queue(p,function(){d.hide("slow",function(){d.remove()})}).dequeue(p);a.toolbar&&a.toolbar.find("#showCompleted").get(0).checked===true&&f(true);d.focus()})},lists:n.list_item.list_id,list_items:n.list_item.id,send:n})},u=function(d,n,p){p!==""&&d.clearQueue(p);n.list_item.completed=false;ListListItem.Update({successCallback:function(){d.find(".undo").hide("slow",function(){$(this).remove()});d.find(".list-item-wrapper").show("slow",function(){g(d)});a.toolbar&&a.toolbar.find("#showCompleted").get(0).checked===
true&&f(true)},lists:n.list_item.list_id,list_items:n.list_item.id,send:n})},f=function(d){if(d===true){if(a.completedList){a.completedList.remove();a.completedList=null}a.completedList=$('<div id="completedList"></div>');d=a.element.data("data-list");ListListItem.Index({successCallback:function(n,p){$.each(p,function(m,s){a.completedList.append("<div>"+s.list_item.body_rendered+"</div>")});p.length===0&&a.completedList.append("<div>No completed items</div>");a.wrapper.prepend(a.completedList)},send:{show:"completed"},
lists:d.list.id})}else{a.completedList.remove();a.completedList=null}},q=function(){a.header.html("");a.toolbar=$('<div id="list-item-toolbar"> \t\t\t\t<div id="list-name"></div><div id="list-item-toolbar-buttons"> \t\t\t\t<button id="list-item-completed">Completed [space]</button> \t\t\t\t<button id="list-item-new">Create [shift+return]</button> \t\t\t\t<button id="list-item-delete">Delete [del]</button> \t\t\t\t<button id="list-item-edit">Edit [return]</button> \t\t\t\t<button id="list-item-fullsize">Fullsize [l]</button> \t\t\t\t<input type="input" id="list-item-search"/> \t\t\t\t<input type="checkbox" id="showCompleted"/> \t\t\t\t<label for="showCompleted">Show Completed Items</label> \t\t\t\t<div id="list-item-search-cancel">&nbsp;</div> \t\t\t\t</div></div>');
a.listName=a.toolbar.find("#list-name");a.toolbar.find("#list-item-new").button({text:false,icons:{primary:"ui-icon-plusthick"}});a.toolbar.find("#list-item-edit").button({text:false,icons:{primary:"ui-icon-pencil"}});a.toolbar.find("#list-item-completed").button({text:false,icons:{primary:"ui-icon-check"}});a.toolbar.find("#list-item-delete").button({text:false,icons:{primary:"ui-icon-trash"}});a.toolbar.find("#list-item-fullsize").button({text:false,icons:{primary:"ui-icon-zoomin"}});a.toolbar.find("#list-item-new").bind("click",
function(){o()});a.toolbar.find("#showCompleted").bind("change",function(d){f(d.target.checked);a.selectedListItem.element.focus()});a.toolbar.find("#list-item-completed").bind("click",function(){t(a.selectedListItem.element,a.selectedListItem.data)});a.toolbar.find("#list-item-delete").bind("click",function(){var d=function(){r(a.selectedListItem.element,a.selectedListItem.data)};if(typeof a.deleteDialog==="undefined")a.deleteDialog=$.confirmationDialog("Delete List Item",d,"Cancel","Do you really want to delete?");
a.deleteDialog.dialog("open")});a.toolbar.find("#list-item-edit").bind("click",function(){a.selectedListItem.element.trigger("dblclick")});a.toolbar.find("#list-item-fullsize").bind("click",function(){h(a.selectedListItem.element)});a.toolbar.find("#list-item-search").bind("keyup",function(){var d=$(this).val();if(d==="")a.listItemList.find(".row").show();else{a.listItemList.find(".row:not(:Contains('"+d+"'))").hide();a.listItemList.find(".row:Contains('"+d+"')").show()}});a.toolbar.find("#list-item-search-cancel").bind("click",
function(){a.toolbar.find("#list-item-search").val("").trigger("keyup")});a.toolbar.find("#list-item-search").bind("ClearValue",function(d){$(d.target).val("");a.listItemList.find(".row").show()});a.header.append(a.toolbar)},o=function(){var d=a.element.data("data-list");ListListItem.New({successCallback:function(n){var p=$(n);a.listItemList.prepend(p);e(p);j();p.find("textarea").markItUp(mySettings);p.find("textarea").focus();a.listItemList.find(".row").hide();p.find("#cancel-edit").bind("click",
function(m){m.preventDefault();p.hide("slow",function(){$(this).remove();a.listItemList.find(".row").show();a.listItemList.find(".row").first().focus()})});p.find(".deadline-button").bind("click",function(m){m.preventDefault();var s=p.serializeForm();s.list_item.body=s.list_item.body.replace(/\n/g,"\n\n");s.list_item.deadlineType=$(m.target).attr("data-deadline");s.list_item.customDeadlineValue=$("#custom-deadline-value").val();ListListItem.Create({send:s,successCallback:function(v,w){p.hide("slow",
function(){k(w,v,true);$(this).remove();a.toolbar.find("#list-item-search").trigger("ClearValue");a.listItemList.find(".row").show();a.listItemList.find(".row").first().focus();a.listItemList.find(".row").first().find(".handle").height(a.listItemList.find(".row").first().find(".list-item-content").height())})},lists:d.list.id});return false});p.find("textarea").bind("keydown","esc",function(){p.find("#cancel-edit").trigger("click")})},lists:d.list.id})};return{options:{},_create:function(){a=this;
a.wrapper=$('<div class="ui-layout-content" id="list-item-wrapper"></div>');a.listItemList=$('<div id="list-item-list"></div>');a.header=$('<div class="header"></div>');a.element.append(a.header);a.element.append(a.wrapper);a.wrapper.append(a.listItemList);c();$(document).bind("keydown","c",function(){var d=a.toolbar.find("#showCompleted");if(d.length>0){if(d.get(0).checked===true)d.get(0).checked=false;else d.get(0).checked=true;d.trigger("change")}});$(document).bind("keyup","f",function(){a.toolbar.find("#list-item-search").focus()})},
destroy:function(){a.children().remove();$(document).unbind("keydown","c");$(document).unbind("keyup","f")},RemoveList:function(){a.wrapper.remove();a.header.remove();$(document).unbind("keydown","c");$(document).unbind("keyup","f")},OpenList:function(d){a.RemoveList();a._create();a.element.data("data-list",d);ListListItem.Index({successCallback:function(n,p){q();$.each(p,function(m,s){k(s,n)});d.id?a.listItemList.find(".row").each(function(){var m=$(this);if(m.data("data").list_item.id===d.id){m.focus();
return false}}):a.listItemList.find(".row").first().focus();a.listItemList.find(".row").length===0&&o();a.listName.text(d.list.title)},lists:d.list.id});l()},SelectListItem:function(){a.selectedListItem?a.selectedListItem.element.effect("highlight",{},300,function(){$(this).show();$(this).focus()}):a.listItemList.find(".row").first().effect("highlight",{},300,function(){$(this).show();$(this).focus()})}}}();$.widget("ui.ListItemView",i)})();
(function(){var i=function(){var a=function(f,q){return f.selectedList===null||f.selectedList.data.list.id!==q.list.id?true:false},c=function(f,q){for(var o in q){var d=q[o];for(var n in d){for(var p=d[n],m=$('<div class="error_explanation"><ul></ul></div>'),s=m.find("ul"),v=f.find("*[name="+(o+"["+n+"]")+"]"),w=0;w<p.length;w++){v.parent(".field").addClass("field_with_errors");s.append("<li>"+p[w]+"</li>")}v.parent(".field").append(m)}}},l=function(f){f.find(".field").removeClass("field_with_errors");
f.find(".error_explanation").remove()},b=function(f,q){var o=f.selectedList.element.next(),d=f.selectedList.element.prev();q=q||0;List.Destroy({successCallback:function(){f.selectedList.element.delay(q).fadeOut(function(){$(this).remove();o.length>0?o.focus():d.focus()});f._trigger("CloseList",0,{})},lists:f.selectedList.data.list.id})},e=function(f){var q=$('<div id="list-toolbar"> \t\t\t\t<button id="list-new">Create [shift+return]</button> \t\t\t\t<button id="list-delete">Delete [del]</button> \t\t\t\t<button id="list-edit">Edit [space]</button> \t\t\t\t<input type="text" id="search-list" /> \t\t\t\t<div id="list-search-cancel">&nbsp;</div> \t\t\t\t</div>');
f.element.find("div.header").append(q);q.find("#list-new").button({text:false,icons:{primary:"ui-icon-plusthick"}});q.find("#list-delete").button({text:false,icons:{primary:"ui-icon-trash"}});q.find("#list-edit").button({text:false,icons:{primary:"ui-icon-pencil"}});q.find("#list-delete").bind("click",{widget:f},function(o){var d=o.data.widget;if(d.selectedList!==null){if(typeof d.deleteDialog==="undefined")d.deleteDialog=$.confirmationDialog("Delete List",function(){if(d.listForm!==null){d.listForm.bind("FormHidden",
function(){b(d,1E3)});u(d)}else b(d)},"Cancel","Do you really want to delete?");d.deleteDialog.dialog("open")}else $("#notice").text("Select the list which you want to delete").fadeIn().delay(5E3).fadeOut();$(o.target).blur();return false});q.find("#list-new").bind("click",{widget:f},function(o){f.listlist.hide("slide",{direction:"left"},"slow",function(){if(f.listForm!=null){f.listForm.remove();f.listForm=null}f.listForm=$('<div class="ui-layout-content" id="list-form"></div>');f.wrapper.append(f.listForm);
List.New({successCallback:function(d,n){f.listForm.append(d);f.listForm.show("slide",{direction:"left"},"slow",function(){f.listForm.find("#list_title").first().focus()});f._trigger("CloseList",0,{});f.listForm.find("#list-back-button").bind("click",function(){u(f)});f.listForm.find("#list_title").bind("keydown","esc",function(){u(f)});f.listForm.bind("submit",function(p){p.preventDefault();p=$(this).find("form").serializeForm();n.list=p.list;List.Create({send:n,successCallback:function(m,s,v,w,x){l(f.listForm);
if(x===false){u(f,s,m);f.toolbar.find("#search-list").trigger("ClearValue")}else c(f.listForm,x)}})});f.selectedList=null}})});$(o.target).blur();return false});q.find("#search-list").bind("keyup",function(){var o=$(this).val();if(o==="")f.listlist.find(".row").show();else{f.listlist.find(".row:not(:Contains('"+o+"'))").hide();f.listlist.find(".row:Contains('"+o+"')").show()}});q.find("#list-search-cancel").bind("click",function(){q.find("#search-list").val("").trigger("keyup")});q.find("#search-list").bind("ClearValue",
function(o){$(o.target).val("");f.listlist.find(".row").show()});q.find("#list-edit").bind("click",{widget:f},function(o){var d=o.data.widget;d.listlist.hide("slide",{direction:"left"},"slow",function(){if(d.listForm!=null){d.listForm.remove();d.listForm=null}d.listForm=$('<div class="ui-layout-content" id="list-form"></div>');d.wrapper.append(d.listForm);List.Edit({successCallback:function(n){d.listForm.append(n);d.listForm.show("slide",{direction:"left"},"slow",function(){d.listForm.find("#list_title").first().focus()});
d.listForm.find("#list-back-button").bind("click",function(){u(d)});d.listForm.find("#list_title").bind("keydown","esc",function(){u(d)});d.listForm.bind("submit",function(p){p.preventDefault();p=$(this).find("form").serializeForm();List.Update({send:p,successCallback:function(m,s,v,w,x){l(d.listForm);x===false?u(d,s,m):c(d.listForm,x)},lists:d.selectedList.data.list.id});return false})},lists:d.selectedList.data.list.id})})});return q},j=function(f,q,o){var d=$($.mustache(o,q.list));d.attr("tabindex",
0);d.data("data",q);d.addClass("row");d.bind("keydown","down",function(n){n.preventDefault();$(n.target).nextAll("div:visible").first().focus();return false});d.bind("keydown","up",function(n){n.preventDefault();$(n.target).prevAll("div:visible").first().focus();return false});d.bind("focus",{widget:f},function(n){var p=n.data.widget;p.listlist.find(".row").removeClass("selected-row");$(n.target).addClass("selected-row");p.selectedList={element:$(n.target),data:$(n.target).data("data")}});d.bind("keydown dblclick",
"return",function(n){f._trigger("OpenList",0,{selectedList:$(n.target).data("data")})});d.bind("keydown","right",function(){f._trigger("SelectListItem",0,{})});d.bind("keydown","shift+return",function(){f.toolbar.find("#list-new").effect("puff",{},300,function(){$(this).show();$(this).trigger("click")});return false});d.bind("keydown","del",function(){f.toolbar.find("#list-delete").effect("puff",{},300,function(){$(this).show()}).trigger("click")});d.bind("keydown","space",function(){f.toolbar.find("#list-edit").effect("puff",
{},300,function(){$(this).show();$(this).trigger("click")});return false});d.droppable({activeClass:"ui-state-default",hoverClass:"ui-state-hover",accept:".list-item",drop:function(n,p){var m=p.draggable.data("data");p=$(this).data("data");m={list_item:{body:m.list_item.body.replace(/\n/g,"\n\n")}};ListListItem.Create({send:m,successCallback:function(){$(n.target).find(".fake-drop").hide("slow",function(){$(this).remove();d.effect("highlight",{},3E3)})},lists:p.list.id})},over:function(n,p){var m=
$('<div class="fake-drop"></div>');m.html("<p>"+p.helper.text()+"</p>");$(n.target).append(m)},out:function(n){$(n.target).find(".fake-drop").remove()}});return d},k=function(f){f._trigger("ContentDimensionsChanged",0,{})},h=function(f,q,o){f.listlist=$('<div id="list-list"></div>');f.wrapper.append(f.listlist);for(var d=0;d<q.length;d++)f.listlist.append(j(f,q[d],o));k(f)},g=function(f){f.selectedList?f.selectedList.element.effect("highlight",{},300,function(){$(this).show();$(this).focus()}):f.listlist.find(".row").first().effect("highlight",
{},300,function(){$(this).show();$(this).focus()})},r=function(f){$(document).bind("keydown","ctrl+l",function(){g(f)});$(document).bind("keydown","ctrl+f",function(){f.toolbar.find("#search-list").focus()});$(document).bind("keydown","shift+f",function(){f.toolbar.find("#search-list").focus();return false})},t=function(f,q,o){f.listlist.show("slide",{direction:"left"},"slow",function(){if(q){var d=j(f,q,o);a(f,q)?f.listlist.prepend(d):f.selectedList.element.replaceWith(d);f.selectedList={data:q,
element:d}}f.selectedList&&f.selectedList.element.focus()})},u=function(f,q,o){f.listForm.hide("slide",{direction:"left"},"slow",function(){t(f,q,o);f.listForm.trigger("FormHidden");f.selectedList?f.selectedList.element.focus():f.listlist.find(".row").first().focus();f.listForm.remove();f.listForm=null})};return{options:{},selectedList:null,_create:function(){var f=this;f.wrapper=f.element.find("div#list-wrapper");f.toolbar=e(f);f.listForm=null;List.Index({successCallback:function(q,o){f.wrapper.find(".row").remove();
h(f,o,q);f.listlist.find(".row").first().focus()}});r(f)},SelectList:function(){g(this)},destroy:function(){widget.toolbar.remove();widget.listForm.remove();widget.wrapper.find(".row").remove()}}}();$.widget("ui.ListView",i)})();(function(i){i.fn.serializeForm=function(){var a=i(this).find('*[name*="]"]'),c={};i.each(a,function(l,b){var e=i(b);l=e.get(0).name.split("[")[0];b=e.get(0).name.split("[")[1];b=b.replace("]","");e=e.val();c[l]=c[l]||{};c[l][b]=e});return c}})(jQuery);
(function(){var i=function(){return{options:{},_create:function(){var a=this;a.ajaxLoader=$('<div id="ajax-indicator"> \t\t\t\t\t\t<img src="/images/ajax-loader.gif" class="ajax-indicator" /> Loading ... \t\t\t\t\t\t</div>');a.notice=$('<p id="notice"></p>');a.alert=$('<p id="alert"></p>');a.element.append(a.ajaxLoader);a.element.append(a.notice);a.element.append(a.alert);a.notice.hide(function(c){$(c.target).html("")});a.alert.hide(function(c){$(c.target).html("")});a.ajaxLoader.bind("ajaxSend",
function(){$(this).show()}).bind("ajaxComplete",function(){$(this).hide()})},SetNotice:function(a){var c=this;c.notice.text(a);c.notice.fadeIn().delay(5E3).fadeOut(function(){$(this).text("")})},SetAlert:function(a){var c=this;c.alert.text(a);c.alert.fadeIn().delay(5E3).fadeOut(function(){$(this).text("")})},destroy:function(){widget.ajaxLoader.remove();widget.notice.remove();widget.alert.remove()}}}();$.widget("ui.StatusBar",i)})();if(!this.JSON)this.JSON={};
(function(){function i(g){return g<10?"0"+g:g}function a(g){b.lastIndex=0;return b.test(g)?'"'+g.replace(b,function(r){var t=k[r];return typeof t==="string"?t:"\\u"+("0000"+r.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+g+'"'}function c(g,r){var t,u,f=e,q,o=r[g];if(o&&typeof o==="object"&&typeof o.toJSON==="function")o=o.toJSON(g);if(typeof h==="function")o=h.call(r,g,o);switch(typeof o){case "string":return a(o);case "number":return isFinite(o)?String(o):"null";case "boolean":case "null":return String(o);
case "object":if(!o)return"null";e+=j;q=[];if(Object.prototype.toString.apply(o)==="[object Array]"){u=o.length;for(g=0;g<u;g+=1)q[g]=c(g,o)||"null";r=q.length===0?"[]":e?"[\n"+e+q.join(",\n"+e)+"\n"+f+"]":"["+q.join(",")+"]";e=f;return r}if(h&&typeof h==="object"){u=h.length;for(g=0;g<u;g+=1){t=h[g];if(typeof t==="string")if(r=c(t,o))q.push(a(t)+(e?": ":":")+r)}}else for(t in o)if(Object.hasOwnProperty.call(o,t))if(r=c(t,o))q.push(a(t)+(e?": ":":")+r);r=q.length===0?"{}":e?"{\n"+e+q.join(",\n"+e)+
"\n"+f+"}":"{"+q.join(",")+"}";e=f;return r}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+i(this.getUTCMonth()+1)+"-"+i(this.getUTCDate())+"T"+i(this.getUTCHours())+":"+i(this.getUTCMinutes())+":"+i(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var l=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
b=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e,j,k={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},h;if(typeof JSON.stringify!=="function")JSON.stringify=function(g,r,t){var u;j=e="";if(typeof t==="number")for(u=0;u<t;u+=1)j+=" ";else if(typeof t==="string")j=t;if((h=r)&&typeof r!=="function"&&(typeof r!=="object"||typeof r.length!=="number"))throw new Error("JSON.stringify");return c("",
{"":g})};if(typeof JSON.parse!=="function")JSON.parse=function(g,r){function t(u,f){var q,o,d=u[f];if(d&&typeof d==="object")for(q in d)if(Object.hasOwnProperty.call(d,q)){o=t(d,q);if(o!==undefined)d[q]=o;else delete d[q]}return r.call(u,f,d)}g=String(g);l.lastIndex=0;if(l.test(g))g=g.replace(l,function(u){return"\\u"+("0000"+u.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(g.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){g=eval("("+g+")");return typeof r==="function"?t({"":g},""):g}throw new SyntaxError("JSON.parse");}})();
var Mustache=function(){var i=function(){};i.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],pragmas_implemented:{"IMPLICIT-ITERATOR":true},context:{},render:function(a,c,l,b){if(!b){this.context=c;this.buffer=[]}if(!this.includes("",a))if(b)return a;else{this.send(a);return}a=this.render_pragmas(a);a=this.render_section(a,c,l);if(b)return this.render_tags(a,c,l,b);this.render_tags(a,c,l,b)},send:function(a){a!=""&&this.buffer.push(a)},render_pragmas:function(a){if(!this.includes("%",a))return a;
var c=this;return a.replace(new RegExp(this.otag+"%([\\w-]+) ?([\\w]+=[\\w]+)?"+this.ctag),function(l,b,e){if(!c.pragmas_implemented[b])throw{message:"This implementation of mustache doesn't understand the '"+b+"' pragma"};c.pragmas[b]={};if(e){l=e.split("=");c.pragmas[b][l[0]]=l[1]}return""})},render_partial:function(a,c,l){a=this.trim(a);if(!l||l[a]===undefined)throw{message:"unknown_partial '"+a+"'"};if(typeof c[a]!="object")return this.render(l[a],c,l,true);return this.render(l[a],c[a],l,true)},
render_section:function(a,c,l){if(!this.includes("#",a)&&!this.includes("^",a))return a;var b=this;return a.replace(new RegExp(this.otag+"(\\^|\\#)\\s*(.+)\\s*"+this.ctag+"\n*([\\s\\S]+?)"+this.otag+"\\/\\s*\\2\\s*"+this.ctag+"\\s*","mg"),function(e,j,k,h){e=b.find(k,c);if(j=="^")return!e||b.is_array(e)&&e.length===0?b.render(h,c,l,true):"";else if(j=="#")return b.is_array(e)?b.map(e,function(g){return b.render(h,b.create_context(g),l,true)}).join(""):b.is_object(e)?b.render(h,b.create_context(e),
l,true):typeof e==="function"?e.call(c,h,function(g){return b.render(g,c,l,true)}):e?b.render(h,c,l,true):""})},render_tags:function(a,c,l,b){var e=this,j=function(){return new RegExp(e.otag+"(=|!|>|\\{|%)?([^\\/#\\^]+?)\\1?"+e.ctag+"+","g")},k=j(),h=function(r,t,u){switch(t){case "!":return"";case "=":e.set_delimiters(u);k=j();return"";case ">":return e.render_partial(u,c,l);case "{":return e.find(u,c);default:return e.escape(e.find(u,c))}};a=a.split("\n");for(var g=0;g<a.length;g++){a[g]=a[g].replace(k,
h,this);b||this.send(a[g])}if(b)return a.join("\n")},set_delimiters:function(a){a=a.split(" ");this.otag=this.escape_regex(a[0]);this.ctag=this.escape_regex(a[1])},escape_regex:function(a){if(!arguments.callee.sRE)arguments.callee.sRE=new RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\)","g");return a.replace(arguments.callee.sRE,"\\$1")},find:function(a,c){function l(e){return e===false||e===0||e}a=this.trim(a);var b;if(l(c[a]))b=c[a];else if(l(this.context[a]))b=this.context[a];if(typeof b===
"function")return b.apply(c);if(b!==undefined)return b;return""},includes:function(a,c){return c.indexOf(this.otag+a)!=-1},escape:function(a){a=String(a===null?"":a);return a.replace(/&(?!\w+;)|["<>\\]/g,function(c){switch(c){case "&":return"&amp;";case "\\":return"\\\\";case '"':return'"';case "<":return"&lt;";case ">":return"&gt;";default:return c}})},create_context:function(a){if(this.is_object(a))return a;else{var c=".";if(this.pragmas["IMPLICIT-ITERATOR"])c=this.pragmas["IMPLICIT-ITERATOR"].iterator;
var l={};l[c]=a;return l}},is_object:function(a){return a&&typeof a=="object"},is_array:function(a){return Object.prototype.toString.call(a)==="[object Array]"},trim:function(a){return a.replace(/^\s*|\s*$/g,"")},map:function(a,c){if(typeof a.map=="function")return a.map(c);else{for(var l=[],b=a.length,e=0;e<b;e++)l.push(c(a[e]));return l}}};return{name:"mustache.js",version:"0.3.1-dev",to_html:function(a,c,l,b){var e=new i;if(b)e.send=b;e.render(a,c,l);if(!b)return e.buffer.join("\n")}}}();
(function(i){i.mustache=function(a,c,l){return Mustache.to_html(a,c,l)}})(jQuery);
